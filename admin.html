<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Administrador — Callera Laser</title>

  <link rel="icon" type="image/png" sizes="32x32" href="./assets/favicons/favicon-32.png?v=15">
  <link rel="shortcut icon" type="image/png" href="./assets/favicons/favicon-32.png?v=15">

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">

  <style>
    :root{ --muted:#f6f2e9; --ink:#2f2b24; --ok:#2aa846; --warn:#bc7a1a; --danger:#e04141; --chip:#ede2c8; --gold:#c49a3b; }
    main.admin{padding-block:clamp(16px,3vw,22px)}
    .admin .container{display:grid;gap:clamp(12px,2.5vw,18px)}

    .kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:clamp(10px,2vw,14px)}
    .kpi{background:var(--cream);border:1px solid var(--gold);border-radius:var(--radius-m);padding:12px}
    .kpi h4{margin:0 0 6px 0;font:900 .95rem/1 var(--ff-display);color:var(--gold)}
    .kpi p{margin:0;font:700 1.25rem/1 var(--ff-display);color:var(--ink)}
    .kpi small{color:#6f6b63}

    .card-block{background:#fff;border:1px solid var(--gold);border-radius:var(--radius-l);padding:clamp(12px,2.4vw,18px)}
    .card-head{display:flex;align-items:center;justify-content:space-between;gap:1rem;margin-bottom:.8rem}
    .card-head h3{margin:0;font:900 1.1rem/1 var(--ff-display);color:var(--gold)}
    .actions{display:flex;align-items:center;gap:.6rem;flex-wrap:wrap}

    .btn-sm{height:34px;padding:0 .9rem;border-radius:999px;border:1px solid var(--gold);background:#fff;color:var(--gold);cursor:pointer;font:600 .9rem/1 var(--ff-sans);text-decoration:none;display:inline-flex;align-items:center}
    .btn-sm.solid{background:var(--gold);color:#fff;border:0}
    .btn-sm.ghost{background:#fff;border:1px solid var(--gold);color:var(--gold)}
    .btn-sm.danger{background:var(--danger);color:#fff;border:0}

    .table{width:100%;border-collapse:separate;border-spacing:0 8px}
    .table thead th{font:700 .82rem var(--ff-display);text-align:left;color:var(--gold);padding:6px 10px}
    .table tbody tr{background:#fff;border:1px solid var(--gold);border-radius:10px}
    .table tbody td{padding:8px 10px;vertical-align:middle;color:#3a332a;font:500 .92rem var(--ff-sans)}
    .table .chip{display:inline-block;background:var(--chip);padding:.15rem .45rem;border-radius:999px;font:700 .75rem var(--ff-sans);color:#6a530f}
    .table td.actions-col{white-space:nowrap}

    dialog.modal{border:0;border-radius:16px;padding:0;max-width:min(860px,92vw)}
    dialog::backdrop{background:rgb(0 0 0 /.5)}
    .modal .wrap{padding:16px;background:#fff;border:2px solid var(--gold);border-radius:16px;position:relative}
    .modal .head{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
    .modal h4{margin:0;font:900 1.1rem var(--ff-display);color:var(--gold)}
    .modal .close{background:transparent;border:0;font-size:24px;cursor:pointer;color:var(--gold)}

    .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:.9rem}
    .form-grid .full{grid-column:1/-1}
    .form-field{display:flex;flex-direction:column;gap:.35rem}
    .form-field label{font:700 .85rem var(--ff-display);color:var(--gold)}
    .form-field input,.form-field textarea,.form-field select{width:100%;background:#fff;border:1px solid var(--gold);border-radius:10px;padding:.65rem .9rem;font:500 .95rem var(--ff-sans);color:#2d2a25}

    .checks{display:grid;grid-template-columns:1fr 1fr;gap:.9rem}
    .checkcard{border:1px dashed var(--gold);border-radius:12px;padding:.6rem .7rem;display:flex;align-items:center;gap:.6rem}
    .checkcard input{width:18px;height:18px;accent-color:var(--gold)}
    .checkcard label{font:600 .92rem var(--ff-sans);color:#2d2a25}

    .cat-list{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:.45rem;max-height:240px;overflow:auto;border:1px solid var(--gold);border-radius:12px;padding:.6rem}
    .cat-item{display:flex;align-items:center;gap:.55rem;padding:.35rem .45rem;border-radius:8px}
    .cat-item input{width:18px;height:18px;accent-color:var(--gold)}

    .form-foot{display:flex;justify-content:space-between;gap:.5rem;margin-top:.75rem}
    .muted{color:#6b6358} .right{justify-content:flex-end}
    .hidden{display:none !important}

    #authGate{display:none;position:fixed;inset:0;z-index:1000;background:#000;align-items:center;justify-content:center;padding:1rem;}
    #authBox{background:#fff;border:2px solid var(--gold);border-radius:18px;max-width:420px;width:100%;padding:1rem 1rem 1.2rem}
    #authBox h3{margin:0 0 .75rem 0;font:900 1.15rem var(--ff-display);color:var(--gold)}
    #authBox .row{display:grid;gap:.65rem;margin:.25rem 0}
    #authBox input{border-radius:12px;border:1px solid var(--gold);padding:.7rem .85rem}
    #authBox .btn-sm.solid{width:100%;justify-content:center}

    /* Toast sempre por cima */
    #toast{position:fixed;inset:auto 0 12px 0;display:grid;place-items:center;pointer-events:none;z-index:2147483647}
    .toast{min-width:min(92vw,560px);max-width:92vw;background:#fff;border:2px solid var(--gold);border-radius:14px;padding:.9rem 1rem;font:600 .95rem var(--ff-sans);color:#2f2b24;box-shadow:0 10px 30px rgba(0,0,0,.25);opacity:0;transform:translateY(6px);transition:.25s}
    .toast.show{opacity:1;transform:translateY(0)}
    .toast.ok{border-color:#2aa846}.toast.warn{border-color:#bc7a1a}.toast.err{border-color:#e04141}

    #pImagePreview{width:100%;max-height:160px;object-fit:cover;border:1px solid var(--gold);border-radius:10px}
  </style>
</head>
<body>
  <div id="app-header" data-partial="partials/barra-superior-admin.html"></div>
  

  <!-- LOGIN (só aparece se necessário) -->
  <div id="authGate" aria-hidden="true">
    <div id="authBox" role="dialog" aria-modal="true" aria-labelledby="authTitle">
      <h3 id="authTitle">Login do Administrador</h3>
      <form id="authForm" class="row">
        <input id="authEmail" type="email" placeholder="email@empresa.com" required>
        <input id="authPass" type="password" placeholder="Senha" required>
        <button class="btn-sm solid" type="submit">Entrar</button>
      </form>
      <p class="muted" style="font-size:.9rem">A sessão fica salva neste navegador.</p>
    </div>
  </div>

  <main class="admin">
    <div class="container">
      <!-- DASHBOARD -->
      <section id="dash" class="card-block">
        <div class="card-head">
          <h3>Dashboard</h3>
          <div class="actions">
            <a class="btn-sm ghost" href="index.html" target="_blank" rel="noopener">Ver site</a>
            <button id="btnLogout" class="btn-sm danger" type="button">Sair</button>
          </div>
        </div>

        <div class="kpis">
          <div class="kpi"><h4>Produtos ativos</h4><p id="kpiProducts">0</p><small class="muted">em catálogo</small></div>
          <div class="kpi"><h4>Pedidos (total)</h4><p id="kpiOrders">0</p><small class="muted">desde o início</small></div>
          <div class="kpi"><h4>Hoje</h4><p id="kpiToday">0</p><small class="muted">pedidos</small></div>
        </div>
      </section>

      <!-- PRODUTOS -->
      <section id="produtos" class="card-block">
        <div class="card-head">
          <h3>Produtos</h3>
          <div class="actions">
            <input id="searchProducts" type="search" placeholder="Filtrar por nome" class="btn-sm" style="width:240px">
            <button class="btn-sm solid" id="btnNewProduct">Novo produto</button>
          </div>
        </div>

        <div class="table-wrap">
          <table class="table" id="tblProducts" aria-label="Tabela de produtos">
            <thead>
              <tr>
                <th>Nome</th>
                <th>Preço</th>
                <th>Promoção</th>
                <th>Parcelas?</th>
                <th>Valor parcela</th>
                <th>Estoque</th>
                <th>Categorias</th>
                <th>Destaque</th>
                <th class="right">Ações</th>
              </tr>
            </thead>
            <tbody><!-- via JS --></tbody>
          </table>
        </div>

        <div class="actions" style="margin-top:.5rem;">
          <button class="btn-sm ghost" id="btnToggleMore" type="button">Ver mais</button>
        </div>
      </section>

      <!-- CATEGORIAS (sem slug) -->
      <section id="categorias" class="card-block">
        <div class="card-head">
          <h3>Categorias</h3>
          <div class="actions">
            <input id="catName" class="btn-sm" type="text" placeholder="Nova categoria (ex.: Promocionais)" />
            <button id="btnAddCat" class="btn-sm solid" type="button">Adicionar</button>
          </div>
        </div>

        <div class="table-wrap">
          <table class="table" id="tblCats" aria-label="Tabela de categorias">
            <thead>
              <tr>
                <th>Nome</th>
                <th class="right">Ações</th>
              </tr>
            </thead>
            <tbody><!-- via JS --></tbody>
          </table>
        </div>
      </section>

      <!-- PEDIDOS -->
      <section id="pedidos" class="card-block">
        <div class="card-head">
          <h3>Pedidos</h3>
          <div class="actions">
            <select id="orderFilter" class="btn-sm">
              <option value="all">Todos</option>
              <option value="today">Hoje</option>
              <option value="whatsapp">Enviados para WhatsApp</option>
            </select>
          </div>
        </div>

        <div class="table-wrap">
          <table class="table" id="tblOrders" aria-label="Tabela de pedidos">
            <thead>
              <tr>
                <th>#</th>
                <th>Cliente</th>
                <th>Itens</th>
                <th>Quando</th>
                <th>Status</th>
                <th class="right">Ações</th>
              </tr>
            </thead>
            <tbody><!-- via JS --></tbody>
          </table>
        </div>

        <div class="actions" style="margin-top:.5rem;">
          <button class="btn-sm ghost" id="btnToggleMoreOrders" type="button">Ver mais</button>
        </div>
      </section>
    </div>
  </main>

  <!-- MODAL: Produto -->
  <dialog class="modal" id="productModal">
    <div class="wrap">
      <div class="head">
        <h4 id="productModalTitle">Novo produto</h4>
        <button class="close" type="button" data-close>×</button>
      </div>

      <form id="formProduct" novalidate>
        <div class="form-grid">
          <div class="form-field">
            <label for="pName">Nome</label>
            <input id="pName" name="name" type="text" placeholder="Axila — Pacote" required>
          </div>

          <div class="form-field">
            <label for="pPrice">Preço (R$)</label>
            <input id="pPrice" name="price" type="text" inputmode="decimal" placeholder="89,99" required>
          </div>

          <div class="form-field">
            <label for="pPromo">Preço promocional (R$)</label>
            <input id="pPromo" name="promoPrice" type="text" inputmode="decimal" placeholder="79,99" disabled>
          </div>

          <div class="form-field">
            <label for="pStock">Estoque (qtd)</label>
            <input id="pStock" name="stock" type="number" min="0" step="1" placeholder="0" disabled>
          </div>

          <div class="full checks">
            <div class="checkcard">
              <input id="pOnSale" type="checkbox"><label for="pOnSale">Em promoção</label>
            </div>
            <div class="checkcard">
              <input id="pTrackStock" type="checkbox"><label for="pTrackStock">Controlar estoque</label>
            </div>
            <div class="checkcard">
              <input id="pFeatured" type="checkbox"><label for="pFeatured">Destaque (máx. 5)</label>
            </div>
          </div>

          <div class="form-field">
            <label for="pImage">Imagem do produto</label>
            <input id="pImage" name="image" type="file" accept="image/*">
            <small class="muted">JPG/PNG/WebP. Sugerido ~272×172.</small>
          </div>

          <div class="form-field">
            <label>Pré-visualização</label>
            <img id="pImagePreview" alt="" />
          </div>

          <div class="form-field full">
            <label>Categorias</label>
            <div id="catsBox" class="cat-list"><!-- via JS --></div>
          </div>

          <div class="form-field full">
            <label for="pDesc">Descrição</label>
            <textarea id="pDesc" name="description" rows="3" placeholder="Descrição do produto..."></textarea>
          </div>

          <!-- PARCELAMENTO -->
          <div class="form-field full" style="border-top:1px dashed #ecdcbc;padding-top:.6rem;margin-top:.2rem">
            <div class="checkcard" style="border-style:solid">
              <input id="pInstEnabled" type="checkbox">
              <label for="pInstEnabled"><strong>Permitir parcelamento</strong></label>
            </div>

            <div class="form-grid" style="margin-top:.6rem">
              <div class="form-field">
                <label for="pInstQty">Qtd. parcelas</label>
                <input id="pInstQty" type="number" min="2" step="1" placeholder="12" disabled>
              </div>
              <div class="form-field">
                <label for="pInstValue">Valor da parcela (R$)</label>
                <input id="pInstValue" type="text" inputmode="decimal" placeholder="89,99" disabled>
              </div>
            </div>
          </div>
        </div>

        <div class="form-foot">
          <button class="btn-sm" type="button" data-close>Cancelar</button>
          <div class="right"><button class="btn-sm solid" type="submit">Salvar</button></div>
        </div>
      </form>
    </div>
  </dialog>

  <div id="toast" aria-live="polite" aria-atomic="true"></div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="js/supabase.js"></script>
  <script src="js/admin.js"></script>
  <script src="js/layout.js"></script>
  <script src="js/auth.js"></script>
</body>
</html>
